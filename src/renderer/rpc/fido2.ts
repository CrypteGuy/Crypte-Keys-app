// Code generated by protoc-gen-tsrpc DO NOT EDIT.
// InputID: 0c92605cf2b904bb0784684b2dc4997d74439d3d
import {ipcRenderer} from 'electron'
import {randomBytes} from 'crypto'

import {
  DetectDevicesRequest,
  DetectDevicesResponse
} from './fido2.fido2'

export interface RPCError {
    code?: number;
    message?: string;
    details?: string;
}

const replyID = (): string => {
  return randomBytes(20).toString('hex')
}

export type ErrHandler = (err: RPCError) => void
var errHandler: ErrHandler = (err: RPCError) => {}
export const setErrHandler = (eh: ErrHandler) => {
  errHandler = eh
}

export const detectDevices = (
  req: DetectDevicesRequest,
  cb: (err: RPCError, resp: DetectDevicesResponse) => void
) => {
  const reply = 'detectDevices-' + replyID()
  ipcRenderer.on(reply, (event, arg) => {
    ipcRenderer.removeAllListeners(reply)
    if (arg.err) {
      console.error('RPC error (detectDevices):', arg.err)
      errHandler(arg.err)
    } else {
      console.log('RPC (detectDevices) done')
    }
    cb(arg.err, arg.resp)
  })
  console.log('RPC (detectDevices)...')
  ipcRenderer.send('rpc', {method: 'detectDevices', args: req, reply: reply})
}

